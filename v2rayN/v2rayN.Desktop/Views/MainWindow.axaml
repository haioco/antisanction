<Window
    x:Class="v2rayN.Desktop.Views.MainWindow"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:dialogHost="clr-namespace:DialogHostAvalonia;assembly=DialogHost.Avalonia"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:resx="clr-namespace:ServiceLib.Resx;assembly=ServiceLib"
    xmlns:view="using:v2rayN.Desktop.Views"
    xmlns:vms="clr-namespace:ServiceLib.ViewModels;assembly=ServiceLib"
    xmlns:models="clr-namespace:ServiceLib.Models;assembly=ServiceLib"
    Title="HAIO Anti-Sanction"
    Width="1400"
    Height="900"
    MinWidth="1200"
    MinHeight="800"
    x:DataType="vms:MainWindowViewModel"
    Icon="/Assets/haio-antisanction.ico"
    ShowInTaskbar="True"
    WindowStartupLocation="CenterScreen"
    Background="{DynamicResource MainBackgroundBrush}"
    mc:Ignorable="d">

    <dialogHost:DialogHost
        Background="Gray"
        CloseOnClickAway="True"
        DisableOpeningAnimation="True">
        <dialogHost:DialogHost.DialogContent>
            <!-- HAIO Login Dialog -->
            <Border
                x:Name="haioLoginDialog"
                Width="460"
                Height="520"
                Classes="ModernCard"
                IsVisible="True">
                <Grid Margin="30">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <StackPanel Grid.Row="0" Margin="0,0,0,25">
                        <TextBlock
                            FontSize="24"
                            FontWeight="Bold"
                            Foreground="{DynamicResource AccentText}"
                            HorizontalAlignment="Center"
                            Text="HAIO Authentication" />
                        <TextBlock
                            Margin="0,8,0,0"
                            FontSize="14"
                            Foreground="{DynamicResource SecondaryText}"
                            HorizontalAlignment="Center"
                            TextWrapping="Wrap"
                            Text="Please login to access anti-sanction proxy services" />
                    </StackPanel>

                    <!-- Login Form -->
                    <TabControl x:Name="loginTabControl" Grid.Row="1" Background="Transparent">
                        <!-- OTP Login Tab -->
                        <TabItem Header="Mobile OTP" FontSize="13" FontWeight="Medium">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel Margin="15" Spacing="20">
                                    <StackPanel Spacing="8">
                                        <TextBlock Text="Mobile Number" FontSize="14" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryText}" />
                                        <TextBox x:Name="txtOtpMobile" Classes="ModernTextBox" Height="40"
                                                 Watermark="09123456789 or +989123456789" KeyDown="TxtOtpMobile_KeyDown" />
                                    </StackPanel>

                                    <Button x:Name="btnRequestOtp" Classes="ModernButton" Height="44"
                                            Background="#17A2B8" Content="Send Verification Code" />

                                    <StackPanel Spacing="8">
                                        <TextBlock Text="Verification Code" FontSize="14" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryText}" />
                                        <TextBox x:Name="txtOtpCode" Classes="ModernTextBox" Height="40"
                                                 MaxLength="8" Watermark="ABC123" IsEnabled="False" KeyDown="TxtOtpCode_KeyDown" />
                                    </StackPanel>

                                    <Button x:Name="btnLogin" Classes="ModernButton" Height="44"
                                            Background="#28A745" Content="Verify &amp; Login" IsEnabled="False" />
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>

                        <!-- Email/Password Login Tab -->
                        <TabItem Header="Email Login" FontSize="13" FontWeight="Medium">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel Margin="15" Spacing="20">
                                    <StackPanel Spacing="8">
                                        <TextBlock Text="Email Address" FontSize="14" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryText}" />
                                        <TextBox x:Name="txtPasswordEmail" Classes="ModernTextBox" Height="40"
                                                 Watermark="your.email@example.com" KeyDown="TxtPasswordEmail_KeyDown" />
                                    </StackPanel>

                                    <StackPanel Spacing="8">
                                        <TextBlock Text="Password" FontSize="14" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryText}" />
                                        <TextBox x:Name="txtPassword" Classes="ModernTextBox" Height="40"
                                                 PasswordChar="●" Watermark="Enter your password" KeyDown="TxtPassword_KeyDown" />
                                    </StackPanel>

                                    <Button x:Name="btnLoginPassword" Classes="ModernButton" Height="44"
                                            Background="#8B5CF6" Content="Login with Email" />
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>
                    </TabControl>

                    <!-- Footer -->
                    <StackPanel Grid.Row="2" Margin="0,25,0,0" Spacing="15">
                        <Border x:Name="globalStatusBorder" Classes="ModernCard" IsVisible="False" Padding="12">
                            <TextBlock x:Name="lblLoginStatus" FontSize="13" Foreground="{DynamicResource ErrorBrush}" 
                                       HorizontalAlignment="Center" Text="" TextWrapping="Wrap" />
                        </Border>

                        <Button x:Name="btnSkipLogin" Classes="ModernButton" Height="36"
                                Background="Transparent" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1"
                                Content="Skip Login (Limited Features)" Foreground="{DynamicResource SecondaryText}" />
                    </StackPanel>
                </Grid>
            </Border>
        </dialogHost:DialogHost.DialogContent>

        <!-- Main UI -->
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            
            <!-- Header -->
            <Border Grid.Row="0" Classes="ModernCard" Margin="20,20,20,10">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    
                    <!-- App Icon and Title -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="16" VerticalAlignment="Center">
                        <Border Width="48" Height="48" CornerRadius="12" Background="#4F46E5" Padding="8">
                            <TextBlock Text="🛡️" FontSize="28" HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="HAIO Anti-Sanction" FontSize="24" FontWeight="Bold" Foreground="{DynamicResource PrimaryText}" />
                            <TextBlock Text="Secure Proxy Protection" FontSize="14" Foreground="{DynamicResource SecondaryText}" />
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- Status Indicator -->
                    <StackPanel Grid.Column="1" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <Canvas Width="20" Height="20">
                            <Ellipse x:Name="statusPulse" Width="20" Height="20" Fill="#DC3545" Classes="PulseAnimation" />
                        </Canvas>
                    </StackPanel>
                    
                    <!-- Window Controls -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                        <ToggleButton x:Name="btnToggleTheme" Width="32" Height="32" Background="#6B7280" 
                                      Content="🌙" CornerRadius="6" FontWeight="Bold" ToolTip.Tip="Toggle Dark/Light Theme">
                            <ToggleButton.Styles>
                                <Style Selector="ToggleButton:checked">
                                    <Setter Property="Content" Value="☀️" />
                                    <Setter Property="Background" Value="#F59E0B" />
                                </Style>
                            </ToggleButton.Styles>
                        </ToggleButton>
                        <Button Content="─" Width="32" Height="32" Background="#F59E0B" Foreground="White" 
                                CornerRadius="6" FontWeight="Bold" ToolTip.Tip="Minimize" />
                        <Button x:Name="btnCloseApp" Content="✕" Width="32" Height="32" Background="#EF4444" 
                                Foreground="White" CornerRadius="6" FontWeight="Bold" ToolTip.Tip="Close" />
                    </StackPanel>
                </Grid>
            </Border>
            
            <!-- Main Content -->
            <Grid Grid.Row="1" Margin="20,0,20,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="300" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="300" />
                </Grid.ColumnDefinitions>
                
                <!-- Left Panel -->
                <StackPanel Grid.Column="0" Spacing="16">
                    <!-- Connection Status -->
                    <Border Classes="ModernCard">
                        <StackPanel Spacing="12">
                            <TextBlock Text="🔗 Connection Status" FontSize="16" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryText}" />
                            <TextBlock x:Name="txtConnectionStatus" Text="Disconnected" FontSize="14" FontWeight="Medium" Foreground="{DynamicResource ErrorBrush}" />
                            <TextBlock x:Name="txtServerInfo" Text="No server selected" FontSize="12" Foreground="{DynamicResource SecondaryText}" />
                        </StackPanel>
                    </Border>
                    
                    <!-- Statistics -->
                    <Border Classes="ModernCard">
                        <StackPanel Spacing="12">
                            <TextBlock Text="📊 Statistics" FontSize="16" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryText}" />
                            <StackPanel Spacing="8">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="⬇️ Download" FontSize="12" Foreground="{DynamicResource SecondaryText}" />
                                    <TextBlock x:Name="txtDownload" Grid.Column="1" Text="0 B/s" FontSize="12" FontWeight="Medium" />
                                </Grid>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="⬆️ Upload" FontSize="12" Foreground="{DynamicResource SecondaryText}" />
                                    <TextBlock x:Name="txtUpload" Grid.Column="1" Text="0 B/s" FontSize="12" FontWeight="Medium" />
                                </Grid>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </StackPanel>
                
                <!-- Center Panel -->
                <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="20" Margin="10,0">
                    <!-- Main Status -->
                    <Border Classes="GlassCard" Padding="30">
                        <StackPanel HorizontalAlignment="Center" Spacing="24">
                            <Border Width="120" Height="120" CornerRadius="60" Background="{DynamicResource PanelBackground}" 
                                    HorizontalAlignment="Center" Padding="20">
                                <TextBlock x:Name="mainStatusIcon" Text="🔴" FontSize="60" 
                                           HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>
                            
                            <StackPanel HorizontalAlignment="Center" Spacing="8">
                                <TextBlock x:Name="txtMainStatus" Text="Anti-Sanction Disabled" 
                                           FontSize="28" FontWeight="Bold" Foreground="{DynamicResource PrimaryText}" 
                                           HorizontalAlignment="Center" />
                                <TextBlock x:Name="txtStatusDescription" 
                                           Text="Configure your connection and activate protection" 
                                           FontSize="16" Foreground="{DynamicResource SecondaryText}" HorizontalAlignment="Center" 
                                           TextWrapping="Wrap" />
                            </StackPanel>
                        </StackPanel>
                    </Border>
                    
                    <!-- Configuration -->
                    <Border Classes="ModernCard">
                        <StackPanel Spacing="20">
                            <TextBlock Text="⚙️ Proxy Configuration" FontSize="18" FontWeight="Bold" 
                                       Foreground="{DynamicResource PrimaryText}" HorizontalAlignment="Center" />
                            
                            <ComboBox x:Name="cmbConfigurations" Classes="ModernComboBox" Height="48" 
                                      PlaceholderText="🔍 Choose a proxy configuration..."
                                      SelectionChanged="CmbConfigurations_SelectionChanged">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate DataType="models:ProfileItemModel">
                                        <StackPanel Spacing="4">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <Border Background="#4F46E5" CornerRadius="4" Padding="4,2">
                                                    <TextBlock Text="{Binding ConfigTypeDisplay}" FontSize="10" 
                                                               FontWeight="Bold" Foreground="White" />
                                                </Border>
                                                <TextBlock Text="{Binding Remarks}" FontSize="14" 
                                                           FontWeight="SemiBold" Foreground="{DynamicResource PrimaryText}" />
                                            </StackPanel>
                                            <TextBlock FontSize="12" Foreground="{DynamicResource SecondaryText}">
                                                <Run Text="{Binding Address}" />
                                                <Run Text=":" />
                                                <Run Text="{Binding Port}" />
                                            </TextBlock>
                                        </StackPanel>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                            
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="12">
                                <Button x:Name="btnRefreshConfigs" Classes="ModernButton" 
                                        Background="#06B6D4" Padding="12,8" Click="BtnRefreshConfigs_Click">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <TextBlock Text="🔄" FontSize="14" />
                                        <TextBlock Text="Refresh" FontSize="12" />
                                    </StackPanel>
                                </Button>
                                <Button x:Name="btnUpdateDomains" Classes="ModernButton" 
                                        Background="#10B981" Padding="12,8" Click="UpdateDomainsButton_Click">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <TextBlock Text="⬇" FontSize="14" />
                                        <TextBlock Text="Update Domains" FontSize="12" />
                                    </StackPanel>
                                </Button>
                                <TextBlock x:Name="txtConfigCount" Text="No configurations loaded" 
                                           FontSize="12" Foreground="{DynamicResource SecondaryText}" VerticalAlignment="Center" />
                            </StackPanel>
                        </StackPanel>
                    </Border>
                    
                    <!-- Toggle Button -->
                    <Border Padding="20" HorizontalAlignment="Center">
                        <ToggleButton x:Name="btnToggleAntiSanction" Width="280" Height="80" 
                                      CornerRadius="40">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <Border Width="56" Height="56" CornerRadius="28" Background="White">
                                    <TextBlock x:Name="toggleIcon" Text="🔴" FontSize="32" 
                                               HorizontalAlignment="Center" VerticalAlignment="Center" />
                                </Border>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock x:Name="toggleText" Text="Activate Protection" 
                                               FontSize="18" FontWeight="Bold" Foreground="White" />
                                    <TextBlock x:Name="toggleSubtext" Text="Click to enable anti-sanction" 
                                               FontSize="12" Foreground="#FEE2E2" />
                                </StackPanel>
                            </StackPanel>
                        </ToggleButton>
                    </Border>
                </StackPanel>
                
                <!-- Right Panel -->
                <StackPanel Grid.Column="2" Spacing="16">
                    <!-- System Info -->
                    <Border Classes="ModernCard">
                        <StackPanel Spacing="12">
                            <TextBlock Text="💻 System Info" FontSize="16" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryText}" />
                            <StackPanel Spacing="6">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="OS Proxy" FontSize="12" Foreground="{DynamicResource SecondaryText}" />
                                    <TextBlock x:Name="txtOSProxy" Grid.Column="1" Text="Disabled" FontSize="12" FontWeight="Medium" />
                                </Grid>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                    
                    <!-- Account Info -->
                    <Border Classes="ModernCard">
                        <StackPanel Spacing="12">
                            <TextBlock Text="📊 Account Info" FontSize="16" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryText}" />
                            <StackPanel Spacing="6">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Config Title" FontSize="12" Foreground="{DynamicResource SecondaryText}" />
                                    <TextBlock x:Name="txtConfigTitle" Grid.Column="1" Text="N/A" FontSize="12" FontWeight="Medium" />
                                </Grid>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Total Traffic" FontSize="12" Foreground="{DynamicResource SecondaryText}" />
                                    <TextBlock x:Name="txtTotalTraffic" Grid.Column="1" Text="N/A" FontSize="12" FontWeight="Medium" />
                                </Grid>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Used Traffic" FontSize="12" Foreground="{DynamicResource SecondaryText}" />
                                    <TextBlock x:Name="txtUsedTraffic" Grid.Column="1" Text="N/A" FontSize="12" FontWeight="Medium" />
                                </Grid>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                    
                    <!-- Quick Actions -->
                    <Border Classes="ModernCard">
                        <StackPanel Spacing="12">
                            <TextBlock Text="⚡ Quick Actions" FontSize="16" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryText}" />
                            <StackPanel Spacing="8">
                                <Button Classes="ModernButton" Background="#17A2B8" 
                                        HorizontalAlignment="Stretch" Height="36" 
                                        Click="BtnUpdateDomains_Click">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="🔄" FontSize="12" />
                                        <TextBlock Text="Update Domains" FontSize="12" />
                                    </StackPanel>
                                </Button>
                                <Button Classes="ModernButton" Background="#28A745" 
                                        HorizontalAlignment="Stretch" Height="36">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="🔍" FontSize="12" />
                                        <TextBlock Text="Test Connection" FontSize="12" />
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </Grid>
    </dialogHost:DialogHost>
</Window>