<Window
    x:Class="v2rayN.Desktop.Views.MainWindow"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:dialogHost="clr-namespace:DialogHostAvalonia;assembly=DialogHost.Avalonia"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:resx="clr-namespace:ServiceLib.Resx;assembly=ServiceLib"
    xmlns:view="using:v2rayN.Desktop.Views"
    xmlns:vms="clr-namespace:ServiceLib.ViewModels;assembly=ServiceLib"
    xmlns:models="clr-namespace:ServiceLib.Models;assembly=ServiceLib"
    Title="HAIO Anti-Sanction"
    Width="1000"
    Height="600"
    MinWidth="900"
    x:DataType="vms:MainWindowViewModel"
    Icon="/Assets/haio-antisanction.ico"
    ShowInTaskbar="True"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">
    <dialogHost:DialogHost
        Background="Gray"
        CloseOnClickAway="True"
        DisableOpeningAnimation="True">
        <dialogHost:DialogHost.DialogContent>
            <!-- HAIO Login Dialog -->
            <Border
                x:Name="haioLoginDialog"
                Width="460"
                Height="520"
                Background="White"
                BoxShadow="0 8 32 #80000000"
                CornerRadius="12"
                IsVisible="True">
                <Grid Margin="30">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <StackPanel Grid.Row="0" Margin="0,0,0,25">
                        <TextBlock
                            FontSize="24"
                            FontWeight="Bold"
                            Foreground="#2563EB"
                            HorizontalAlignment="Center"
                            Text="HAIO Authentication" />
                        <TextBlock
                            Margin="0,8,0,0"
                            FontSize="14"
                            Foreground="#64748B"
                            HorizontalAlignment="Center"
                            TextWrapping="Wrap"
                            Text="Please login to access anti-sanction proxy services" />
                    </StackPanel>

                    <!-- Login Form -->
                    <TabControl x:Name="loginTabControl" Grid.Row="1" Background="Transparent">
                        <!-- OTP Login Tab -->
                        <TabItem Header="Mobile OTP" FontSize="13" FontWeight="Medium">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel Margin="15" Spacing="20">
                                    <!-- Mobile Number Section -->
                                    <StackPanel Spacing="8">
                                        <TextBlock
                                            FontSize="14"
                                            FontWeight="SemiBold"
                                            Foreground="#374151"
                                            Text="Mobile Number" />
                                        <TextBox
                                            x:Name="txtOtpMobile"
                                            Height="40"
                                            Padding="12,10"
                                            FontSize="14"
                                            Watermark="09123456789 or +989123456789"
                                            CornerRadius="6"
                                            BorderBrush="#D1D5DB"
                                            BorderThickness="1"
                                            KeyDown="TxtOtpMobile_KeyDown" />
                                        <TextBlock
                                            FontSize="12"
                                            Foreground="#6B7280"
                                            Text="Enter your Iranian mobile number"
                                            TextWrapping="Wrap" />
                                    </StackPanel>

                                    <!-- Request OTP Button -->
                                    <Button
                                        x:Name="btnRequestOtp"
                                        Height="44"
                                        HorizontalAlignment="Stretch"
                                        Background="#3B82F6"
                                        Content="Send Verification Code"
                                        CornerRadius="6"
                                        FontSize="14"
                                        FontWeight="Medium"
                                        Foreground="White" />

                                    <!-- Status Message -->
                                    <Border
                                        x:Name="otpStatusBorder"
                                        Background="#DBEAFE"
                                        BorderBrush="#3B82F6"
                                        BorderThickness="1"
                                        CornerRadius="6"
                                        IsVisible="False"
                                        Padding="12">
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <TextBlock
                                                FontSize="16"
                                                Text="✓" />
                                            <TextBlock
                                                x:Name="lblOtpStatus"
                                                FontSize="13"
                                                Foreground="#1D4ED8"
                                                Text="Verification code sent to your mobile"
                                                TextWrapping="Wrap" />
                                        </StackPanel>
                                    </Border>

                                    <!-- OTP Code Section -->
                                    <StackPanel Spacing="8">
                                        <TextBlock
                                            FontSize="14"
                                            FontWeight="SemiBold"
                                            Foreground="#374151"
                                            Text="Verification Code" />
                                        <TextBox
                                            x:Name="txtOtpCode"
                                            Height="40"
                                            Padding="12,10"
                                            FontSize="16"
                                            FontWeight="Medium"
                                            IsEnabled="False"
                                            LetterSpacing="1"
                                            MaxLength="8"
                                            Watermark="ABC123"
                                            CornerRadius="6"
                                            BorderBrush="#D1D5DB"
                                            BorderThickness="1"
                                            HorizontalContentAlignment="Center"
                                            KeyDown="TxtOtpCode_KeyDown" />
                                        <TextBlock
                                            FontSize="12"
                                            Foreground="#6B7280"
                                            Text="Enter the alphanumeric code sent to your mobile (4-8 characters)"
                                            TextWrapping="Wrap" />
                                    </StackPanel>

                                    <!-- Login Button -->
                                    <Button
                                        x:Name="btnLogin"
                                        Height="44"
                                        HorizontalAlignment="Stretch"
                                        Background="#10B981"
                                        Content="Verify &amp; Login"
                                        CornerRadius="6"
                                        FontSize="14"
                                        FontWeight="Medium"
                                        Foreground="White"
                                        IsEnabled="False" />
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>

                        <!-- Email/Password Login Tab -->
                        <TabItem Header="Email Login" FontSize="13" FontWeight="Medium">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel Margin="15" Spacing="20">
                                    <!-- Email Section -->
                                    <StackPanel Spacing="8">
                                        <TextBlock
                                            FontSize="14"
                                            FontWeight="SemiBold"
                                            Foreground="#374151"
                                            Text="Email Address" />
                                        <TextBox
                                            x:Name="txtPasswordEmail"
                                            Height="40"
                                            Padding="12,10"
                                            FontSize="14"
                                            Watermark="your.email@example.com"
                                            CornerRadius="6"
                                            BorderBrush="#D1D5DB"
                                            BorderThickness="1"
                                            KeyDown="TxtPasswordEmail_KeyDown" />
                                    </StackPanel>

                                    <!-- Password Section -->
                                    <StackPanel Spacing="8">
                                        <TextBlock
                                            FontSize="14"
                                            FontWeight="SemiBold"
                                            Foreground="#374151"
                                            Text="Password" />
                                        <TextBox
                                            x:Name="txtPassword"
                                            Height="40"
                                            Padding="12,10"
                                            FontSize="14"
                                            PasswordChar="●"
                                            Watermark="Enter your password"
                                            CornerRadius="6"
                                            BorderBrush="#D1D5DB"
                                            BorderThickness="1"
                                            KeyDown="TxtPassword_KeyDown" />
                                    </StackPanel>

                                    <!-- Login Button -->
                                    <Button
                                        x:Name="btnLoginPassword"
                                        Height="44"
                                        HorizontalAlignment="Stretch"
                                        Background="#8B5CF6"
                                        Content="Login with Email"
                                        CornerRadius="6"
                                        FontSize="14"
                                        FontWeight="Medium"
                                        Foreground="White" />
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>
                    </TabControl>

                    <!-- Status and Actions -->
                    <StackPanel Grid.Row="2" Margin="0,25,0,0" Spacing="15">
                        <!-- Global Status Message -->
                        <Border
                            x:Name="globalStatusBorder"
                            Background="#FEF2F2"
                            BorderBrush="#EF4444"
                            BorderThickness="1"
                            CornerRadius="6"
                            IsVisible="False"
                            Padding="12">
                            <TextBlock
                                x:Name="lblLoginStatus"
                                FontSize="13"
                                Foreground="#DC2626"
                                HorizontalAlignment="Center"
                                Text=""
                                TextWrapping="Wrap" />
                        </Border>

                        <!-- Skip Login Button -->
                        <Button
                            x:Name="btnSkipLogin"
                            Height="36"
                            HorizontalAlignment="Center"
                            Background="Transparent"
                            BorderBrush="#D1D5DB"
                            BorderThickness="1"
                            Content="Skip Login (Limited Features)"
                            CornerRadius="6"
                            FontSize="12"
                            Foreground="#6B7280"
                            Padding="16,8" />

                        <!-- Footer Text -->
                        <TextBlock
                            FontSize="11"
                            Foreground="#9CA3AF"
                            HorizontalAlignment="Center"
                            Text="HAIO provides secure proxy services for Iranian users"
                            TextWrapping="Wrap" />
                    </StackPanel>
                </Grid>
            </Border>
        </dialogHost:DialogHost.DialogContent>
        <!-- Simplified Single Button Interface -->
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            
            <!-- Simple Header with Close Button -->
            <Border Grid.Row="0" Background="#F8F9FA" BorderBrush="#E9ECEF" BorderThickness="0,0,0,1" Padding="20,15">
                <DockPanel>
                    <Button x:Name="btnCloseApp" 
                            DockPanel.Dock="Right"
                            Width="30" 
                            Height="30"
                            Background="#DC3545"
                            Foreground="White"
                            Content="✕"
                            CornerRadius="15"
                            FontSize="12"
                            FontWeight="Bold"
                            ToolTip.Tip="Exit Application" />
                    <TextBlock Text="HAIO Anti-Sanction" 
                               FontSize="18" 
                               FontWeight="SemiBold" 
                               Foreground="#2C3E50"
                               VerticalAlignment="Center" />
                </DockPanel>
            </Border>
            
            <!-- Main Content Area with Single Toggle Button -->
            <Grid Grid.Row="1">
                <StackPanel HorizontalAlignment="Center" 
                           VerticalAlignment="Center" 
                           Spacing="30">
                    
                    <!-- Status Display -->
                    <StackPanel HorizontalAlignment="Center" Spacing="15">
                        <TextBlock x:Name="txtConnectionStatus"
                                   Text="🔴 Anti-Sanction is OFF"
                                   FontSize="24"
                                   FontWeight="Medium"
                                   Foreground="#DC3545"
                                   HorizontalAlignment="Center" />
                        
                        <TextBlock x:Name="txtStatusDescription"
                                   Text="Select a configuration and click to activate secure proxy protection"
                                   FontSize="14"
                                   Foreground="#6C757D"
                                   HorizontalAlignment="Center"
                                   TextWrapping="Wrap" />
                    </StackPanel>
                    
                    <!-- Configuration Selection -->
                    <StackPanel HorizontalAlignment="Center" Spacing="12">
                        <TextBlock Text="📋 Select Configuration:"
                                   FontSize="16"
                                   FontWeight="Medium"
                                   Foreground="#495057"
                                   HorizontalAlignment="Center" />
                        
                        <ComboBox x:Name="cmbConfigurations"
                                  Width="350"
                                  Height="40"
                                  FontSize="14"
                                  HorizontalAlignment="Center"
                                  PlaceholderText="Choose a proxy configuration..."
                                  Background="White"
                                  BorderBrush="#DEE2E6"
                                  BorderThickness="1"
                                  CornerRadius="6"
                                  Padding="12,8"
                                  SelectionChanged="CmbConfigurations_SelectionChanged">
                            <ComboBox.ItemTemplate>
                                <DataTemplate DataType="models:ProfileItemModel">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="{Binding ConfigTypeDisplay}"
                                                   FontSize="12"
                                                   FontWeight="SemiBold"
                                                   Foreground="#6C757D"
                                                   VerticalAlignment="Center" />
                                        <TextBlock Text="{Binding Remarks}"
                                                   FontSize="14"
                                                   FontWeight="Medium"
                                                   VerticalAlignment="Center" />
                                        <TextBlock Text="-"
                                                   FontSize="12"
                                                   Foreground="#ADB5BD"
                                                   VerticalAlignment="Center" />
                                        <TextBlock Text="{Binding Address}"
                                                   FontSize="12"
                                                   Foreground="#6C757D"
                                                   VerticalAlignment="Center" />
                                        <TextBlock Text=":"
                                                   FontSize="12"
                                                   Foreground="#6C757D"
                                                   VerticalAlignment="Center" />
                                        <TextBlock Text="{Binding Port}"
                                                   FontSize="12"
                                                   Foreground="#6C757D"
                                                   VerticalAlignment="Center" />
                                    </StackPanel>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                        
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="10">
                            <Button x:Name="btnRefreshConfigs"
                                    Content="🔄 Refresh"
                                    FontSize="12"
                                    Padding="10,6"
                                    Background="#17A2B8"
                                    Foreground="White"
                                    CornerRadius="4"
                                    Click="BtnRefreshConfigs_Click" />
                            <TextBlock x:Name="txtConfigCount"
                                       Text="No configurations loaded"
                                       FontSize="12"
                                       Foreground="#6C757D"
                                       VerticalAlignment="Center" />
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- Main Toggle Button -->
                    <ToggleButton x:Name="btnToggleAntiSanction"
                                  Width="200"
                                  Height="60"
                                  Background="#28A745"
                                  Foreground="White"
                                  Content="🛡️ Activate Anti-Sanction"
                                  CornerRadius="30"
                                  FontSize="16"
                                  FontWeight="SemiBold"
                                  HorizontalContentAlignment="Center"
                                  VerticalContentAlignment="Center">
                        <ToggleButton.Styles>
                            <Style Selector="ToggleButton:checked">
                                <Setter Property="Background" Value="#DC3545" />
                                <Setter Property="Content" Value="🛡️ Deactivate Anti-Sanction" />
                            </Style>
                            <Style Selector="ToggleButton:pointerover">
                                <Setter Property="Background" Value="#218838" />
                            </Style>
                            <Style Selector="ToggleButton:checked:pointerover">
                                <Setter Property="Background" Value="#C82333" />
                            </Style>
                        </ToggleButton.Styles>
                    </ToggleButton>
                    
                    <!-- Connection Info -->
                    <StackPanel HorizontalAlignment="Center" Spacing="8">
                        <TextBlock x:Name="txtServerInfo"
                                   Text="Ready to connect"
                                   FontSize="12"
                                   Foreground="#6C757D"
                                   HorizontalAlignment="Center" />
                        
                        <TextBlock x:Name="txtSpeedInfo"
                                   Text=""
                                   FontSize="11"
                                   Foreground="#6C757D"
                                   HorizontalAlignment="Center" />
                    </StackPanel>
                    
                </StackPanel>
            </Grid>
        </Grid>
    </dialogHost:DialogHost>
</Window>
